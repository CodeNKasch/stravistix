<h2 class="mat-display-1">Fitness trend configuration</h2>

<mat-dialog-content class="mat-body-1">

	<mat-accordion>

		<mat-expansion-panel>
			<mat-expansion-panel-header>
				<mat-panel-title>
					Estimate Running/Cycling stress scores (GPS only)
				</mat-panel-title>
				<mat-panel-description>
					Case where you don't own (or missed) your Heart Rate Monitor or Cycling Power Meter
				</mat-panel-description>
			</mat-expansion-panel-header>

			<div class="PSSEstimation">
				<mat-slide-toggle
					[(ngModel)]="fitnessTrendConfigDialogData.fitnessTrendConfigModel.allowEstimatedPowerStressScore"
					[disabled]="!(fitnessTrendConfigDialogData.hasCyclingFtp && fitnessTrendConfigDialogData.isPowerMeterEnabled)">
					Enable Cycling Power Stress Score (PSS) Estimation.
				</mat-slide-toggle>

				<div class="hint"
					 *ngIf="!(fitnessTrendConfigDialogData.hasCyclingFtp && fitnessTrendConfigDialogData.isPowerMeterEnabled)">

					<mat-icon color="warn" [style.vertical-align]="'bottom'">warning</mat-icon>
					PSS Estimation is currently disabled. Make sure you set your <strong>Cycling Functional Threshold
					Power</strong> in
					<a [routerLink]="'/athleteSettings'" (click)="dialogRef.close()">athlete settings</a> and you
					enabled power meter
					toggle (
					<mat-icon [style.vertical-align]="'bottom'">flash_on</mat-icon>
					) in fitness trend before.
				</div>
			</div>

			<div>
				<mat-slide-toggle
					[(ngModel)]="fitnessTrendConfigDialogData.fitnessTrendConfigModel.allowEstimatedRunningStressScore"
					[disabled]="!fitnessTrendConfigDialogData.hasRunningFtp">
					Enable Running Stress Score (RSS) Estimation.
				</mat-slide-toggle>

				<div class="hint" *ngIf="!fitnessTrendConfigDialogData.hasRunningFtp">
					<mat-icon color="warn" [style.vertical-align]="'bottom'">warning</mat-icon>
					RSS Estimation is currently disabled. Make sure you set your <strong>Running Functional Threshold
					Pace</strong> in <a [routerLink]="'/athleteSettings'" (click)="dialogRef.close()">athlete
					settings</a> before.
				</div>
			</div>

		</mat-expansion-panel>

		<mat-expansion-panel>
			<mat-expansion-panel-header>
				<mat-panel-title>Exclude activities from fitness trend</mat-panel-title>
				<mat-panel-description>Case where you want to ignore activities by their name</mat-panel-description>
			</mat-expansion-panel-header>

			<div class="hint">
				Here you can exclude unwanted activities from the fitness trend based on their names and exclusion
				patterns. Example use case: you performed some "Mountain Bike Downhill" activities without a heart rate
				monitor or power meter. You took the ski lift many times. If you enable the "Cycling Power Stress Score
				(PSS) Estimation", stress scores are gonna to be huge and not relevant of your efforts due to the
				important total ascent coming from ski lifts. And so the fitness trend could be impacted by unwanted
				stress scores. Assuming you put the tag "#MTBDH" in all these activities, you just need to append a line
				"#MTBDH" in the below input to exclude them. Note: you may need to change some activities name directly
				in strava and launch a manual sync to see the exclusion.
			</div>

			<textarea matInput
					  [(ngModel)]="ignoreActivityNamePatterns"
					  (change)="onIgnoreActivityNamePatternsChange()"
					  rows="5"
					  placeholder="Enter activity name patterns exclusion (1 per line, case sensitive)"></textarea>

		</mat-expansion-panel>

		<mat-expansion-panel>
			<mat-expansion-panel-header>
				<mat-panel-title>
					Exclude activities until a date
				</mat-panel-title>
				<mat-panel-description>
					Can be useful to ignore previous seasons for example
				</mat-panel-description>
			</mat-expansion-panel-header>

			<div class="hint">
				You can exclude activities from your fitness trend if they are before a specific date. You can set that
				date in the below input. Leaving a field empty means no exclusion. Note: The starting date will be set
				on the first activity available after that date.
			</div>

			<mat-form-field>
				<input matInput
					   [(ngModel)]="ignoreBeforeDate"
					   [max]="ignoreBeforeMaxDate"
					   [matDatepicker]="datePickerTo"
					   (dateChange)="onIgnoreBeforeDateChange()"
					   placeholder="Ignore activities before">
				<mat-datepicker-toggle matSuffix [for]="datePickerTo"></mat-datepicker-toggle>
				<mat-datepicker #datePickerTo></mat-datepicker>
			</mat-form-field>

		</mat-expansion-panel>

		<mat-expansion-panel>
			<mat-expansion-panel-header>
				<mat-panel-title>
					Start with existing fitness and fatigue values
				</mat-panel-title>
				<mat-panel-description>
					Fitness trend will start with these values.
				</mat-panel-description>
			</mat-expansion-panel-header>

			<div class="hint">
				Your fitness trend will start with the below values. Leaving a field empty equals to set a value of
				<strong>0</strong>
			</div>

			<div fxLayout="column" fxLayoutAlign="start start">
				<mat-form-field fxFlex>
					<input
						matInput
						type="number" min="1"
						[(ngModel)]="fitnessTrendConfigDialogData.fitnessTrendConfigModel.initializedFitnessTrendModel.ctl"
						(change)="onInitialFitnessChange()"/>
					<mat-placeholder>
						Fitness starting value
					</mat-placeholder>
				</mat-form-field>
				<span fxFlex="1"></span>
				<mat-form-field fxFlex>
					<input
						matInput
						type="number" min="1"
						[(ngModel)]="fitnessTrendConfigDialogData.fitnessTrendConfigModel.initializedFitnessTrendModel.atl"
						(change)="onInitialFatigueChange()"/>
					<mat-placeholder>
						Fatigue starting value
					</mat-placeholder>
				</mat-form-field>
			</div>

		</mat-expansion-panel>

		<mat-expansion-panel>
			<mat-expansion-panel-header>
				<mat-panel-title>
					Heart rate stress score calculation mode
				</mat-panel-title>
				<mat-panel-description>
					Choose how stress scores is being computed from heart rate data
				</mat-panel-description>
			</mat-expansion-panel-header>

			<mat-radio-group (change)="onModeChange()"
							 [(ngModel)]="fitnessTrendConfigDialogData.fitnessTrendConfigModel.heartRateImpulseMode">
				<mat-radio-button [value]="HeartRateImpulseMode.HRSS">HRSS: Heart Rate Stress Score (recommend)
				</mat-radio-button>
				<mat-radio-button [value]="HeartRateImpulseMode.TRIMP">TRIMP: Training Impulse (not recommend)
				</mat-radio-button>
			</mat-radio-group>

			<div
				*ngIf="(fitnessTrendConfigDialogData.fitnessTrendConfigModel.heartRateImpulseMode === HeartRateImpulseMode.TRIMP)">
				<span>
					<mat-icon color="warn" [style.vertical-align]="'bottom'">warning</mat-icon>
					When heart rate stress score calculation method is set to TRIMP (Training Impulse):
					<ul>
						<li>
							Training Zones will be disabled because TRIMP has a scale missmatch with Training Zones.
						</li>
						<li>
							Cycling Power Stress Scores (PSS) will not be taken into account because TRIMP scores are not scaled with PSS stress scores.
						</li>
						<li>
							Swimming Stress Scores (SSS) will not be taken into account because TRIMP scores are not scaled with SSS stress scores.
						</li>
					</ul>
				</span>
			</div>

		</mat-expansion-panel>

	</mat-accordion>

	<div class="note">
		Note: the fitness trend configuration is saved locally only. She's not synced between browsers where plugin is
		installed.
	</div>

</mat-dialog-content>

<mat-dialog-actions>
	<button mat-button mat-dialog-close color="primary" (click)="onSave()">Save</button>
	<button mat-button mat-dialog-close color="primary" (click)="onCancel()">Cancel</button>
</mat-dialog-actions>
